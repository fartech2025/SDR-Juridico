# ğŸ“Š VISUALIZAÃ‡ÃƒO: Hierarquia de Acesso - SDR JurÃ­dico

---

## ğŸ¯ Diagrama da Hierarquia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SISTEMA DE PERMISSÃ•ES - SDR JURÃDICO                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  NÃ­vel 1: FARTECH ADMIN                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ IdentificaÃ§Ã£o: usuarios.permissoes = ['fartech_admin']           â”‚  â”‚
â”‚  â”‚ Mapeamento: fartech_admin (sem mapeamento)                       â”‚  â”‚
â”‚  â”‚ Escopo: TODAS as organizaÃ§Ãµes                                    â”‚  â”‚
â”‚  â”‚ PermissÃµes: 11 recursos Ã— manage = ACESSO TOTAL                  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚ âœ… organizations | users | leads | clients | cases |             â”‚  â”‚
â”‚  â”‚    documents | agenda | integrations | settings | billing |       â”‚  â”‚
â”‚  â”‚    reports                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  NÃ­vel 2: ORG ADMIN (Gestor)                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ IdentificaÃ§Ã£o: org_members.role IN ('admin', 'gestor')           â”‚  â”‚
â”‚  â”‚ Mapeamento: org_members.role â†’ 'org_admin' (TypeScript)          â”‚  â”‚
â”‚  â”‚ Escopo: APENAS sua organizaÃ§Ã£o                                   â”‚  â”‚
â”‚  â”‚ PermissÃµes: 11 recursos Ã— 25 aÃ§Ãµes                                â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚ âœ… users:create|read|update|delete                               â”‚  â”‚
â”‚  â”‚ âœ… leads|clients|cases|documents|agenda: MANAGE                  â”‚  â”‚
â”‚  â”‚ âœ… integrations|settings: MANAGE                                 â”‚  â”‚
â”‚  â”‚ âœ… tarafas: APPROVE|REJECT                                       â”‚  â”‚
â”‚  â”‚ âœ… billing: READ                                                 â”‚  â”‚
â”‚  â”‚ âœ… reports: READ|CREATE                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  NÃ­vel 3: USER (Advogado/SecretÃ¡ria/Leitura)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ IdentificaÃ§Ã£o: org_members.role IN ('advogado','secretaria','   â”‚  â”‚
â”‚  â”‚                                      leitura')                    â”‚  â”‚
â”‚  â”‚ Mapeamento: org_members.role â†’ 'user' (TypeScript)               â”‚  â”‚
â”‚  â”‚ Escopo: APENAS sua organizaÃ§Ã£o                                   â”‚  â”‚
â”‚  â”‚ PermissÃµes: 9 recursos Ã— 20 aÃ§Ãµes                                 â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚ âœ… organizations|users: READ                                     â”‚  â”‚
â”‚  â”‚ âœ… leads|clients|cases|documents|agenda:CREATE|READ|UPDATE       â”‚  â”‚
â”‚  â”‚ âœ… agenda: DELETE (seus prÃ³prios)                                â”‚  â”‚
â”‚  â”‚ âœ… integrations|reports: READ                                    â”‚  â”‚
â”‚  â”‚ âŒ settings (SEM ACESSO)                                         â”‚  â”‚
â”‚  â”‚ âŒ billing (SEM ACESSO)                                          â”‚  â”‚
â”‚  â”‚ âŒ tarefas: APPROVE|REJECT (bloqueado)                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Tabela Comparativa

| Capacidade | Advogado | Gestor | Admin Fartech |
|---|---|---|---|
| **Visibilidade** | | | |
| VÃª sua org | âœ… | âœ… | âœ… |
| VÃª todas orgs | âŒ | âŒ | âœ… |
| **Leads** | | | |
| Criar | âœ… | âœ… | âœ… |
| Editar seus | âœ… | âœ… | âœ… |
| Editar outros | âŒ | âœ… | âœ… |
| Deletar | âŒ | âŒ | âœ… |
| **Casos** | | | |
| Criar | âœ… | âœ… | âœ… |
| Editar | âœ… | âœ… | âœ… |
| **Tarefas** | | | |
| Ver | âœ… (suas) | âœ… (todas) | âœ… (todas) |
| Submeter | âœ… | âœ… | âœ… |
| Aprovar | âŒ | âœ… | âœ… |
| Rejeitar | âŒ | âœ… | âœ… |
| **GestÃ£o** | | | |
| UsuÃ¡rios | âŒ | âœ… | âœ… |
| IntegraÃ§Ãµes | âŒ | âœ… | âœ… |
| Settings | âŒ | âœ… | âœ… |
| Billing | âŒ | âœ… (read) | âœ… |

---

## ğŸ”„ Fluxo de Tarefa Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUXO DE TAREFA COM APROVAÃ‡ÃƒO (Agora Funcional) âœ…                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  1. ADVOGADO cria tarefa                                            â”‚
â”‚     â”œâ”€ POST /tarefas                                                â”‚
â”‚     â”œâ”€ status: 'pendente'                                           â”‚
â”‚     â”œâ”€ assigned_to: advogado_id                                     â”‚
â”‚     â””â”€ created_at: now()                                            â”‚
â”‚                         â†“                                            â”‚
â”‚  2. ADVOGADO trabalha em tarefa                                     â”‚
â”‚     â”œâ”€ ImplementaÃ§Ã£o                                                â”‚
â”‚     â”œâ”€ Pesquisa                                                     â”‚
â”‚     â””â”€ PreparaÃ§Ã£o                                                   â”‚
â”‚                         â†“                                            â”‚
â”‚  3. ADVOGADO SUBMETE (âœ… AGORA FUNCIONA)                            â”‚
â”‚     â”œâ”€ POST /tarefas/{id}/submit                                    â”‚
â”‚     â”œâ”€ status: 'aguardando_validacao' (novo status)                 â”‚
â”‚     â”œâ”€ submitted_at: now() (novo campo)                             â”‚
â”‚     â””â”€ NotificaÃ§Ã£o enviada ao gestor                                â”‚
â”‚                         â†“                                            â”‚
â”‚  4a. GESTOR APROVA (âœ… AGORA FUNCIONA)                              â”‚
â”‚      â”œâ”€ POST /tarefas/{id}/approve                                  â”‚
â”‚      â”œâ”€ isCurrentUserAdminish() â†’ true âœ…                           â”‚
â”‚      â”œâ”€ status: 'concluida'                                         â”‚
â”‚      â”œâ”€ confirmed_at: now() (novo campo)                            â”‚
â”‚      â”œâ”€ confirmed_by: gestor_id (novo campo)                        â”‚
â”‚      â””â”€ Tarefa marcada como completa                                â”‚
â”‚                                                                       â”‚
â”‚  4b. GESTOR REJEITA (âœ… AGORA FUNCIONA)                             â”‚
â”‚      â”œâ”€ POST /tarefas/{id}/reject                                   â”‚
â”‚      â”œâ”€ isCurrentUserAdminish() â†’ true âœ…                           â”‚
â”‚      â”œâ”€ status: 'devolvida'                                         â”‚
â”‚      â”œâ”€ rejected_reason: motivo (novo campo)                        â”‚
â”‚      â””â”€ Advogado pode retomar e resubmeter                          â”‚
â”‚                         â†“                                            â”‚
â”‚  5. ADVOGADO recebe feedback                                        â”‚
â”‚     â””â”€ Pode retomar a tarefa                                        â”‚
â”‚                                                                       â”‚
â”‚  âœ… FLUXO COMPLETO FUNCIONANDO                                      â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Fluxo de VerificaÃ§Ã£o de Acesso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VERIFICAÃ‡ÃƒO DE ACESSO EM CAMADAS (Defense in Depth)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  CAMADA 1: AUTENTICAÃ‡ÃƒO                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ if (!user) return 'Usuario nÃ£o autenticado'                    â”‚  â”‚
â”‚  â”‚ Token JWT vÃ¡lido? â†’ Continu                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                        â”‚
â”‚  CAMADA 2: PERMISSÃƒO                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ checkPermission({ resource: 'tarefas', action: 'approve' })   â”‚  â”‚
â”‚  â”‚ â”œâ”€ Busca permissÃµes do role                                   â”‚  â”‚
â”‚  â”‚ â”œâ”€ Procura { 'tarefas', 'approve' } em PERMISSIONS            â”‚  â”‚
â”‚  â”‚ â””â”€ if (!encontrado) return 'PermissÃ£o negada'                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                        â”‚
â”‚  CAMADA 3: RLS (Row Level Security)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SELECT * FROM tarefas WHERE org_id = current_org_id           â”‚  â”‚
â”‚  â”‚ â”œâ”€ Verifica se usuario Ã© membro da org                        â”‚  â”‚
â”‚  â”‚ â”œâ”€ Verifica se Ã© admin/gestor ou task assignee                â”‚  â”‚
â”‚  â”‚ â””â”€ if (falha) retorna 0 registros                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                        â”‚
â”‚  CAMADA 4: VALIDAÃ‡ÃƒO DE INPUT                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”œâ”€ UUID vÃ¡lido?                                               â”‚  â”‚
â”‚  â”‚ â”œâ”€ Tipos corretos?                                            â”‚  â”‚
â”‚  â”‚ â”œâ”€ Tamanho dentro dos limites?                                â”‚  â”‚
â”‚  â”‚ â””â”€ if (falha) throw ValidationError                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                        â”‚
â”‚  âœ… ACESSO PERMITIDO - Executar aÃ§Ã£o                                â”‚
â”‚                                                                        â”‚
â”‚  RESULTADO: ProteÃ§Ã£o robusta em mÃºltiplas camadas                   â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Mapeamento de Roles (Banco â†’ TypeScript)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAPEAMENTO: Valores no Banco â†’ Valores no TypeScript            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Banco (org_members.role)     FunÃ§Ã£o              TypeScript     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  'admin'               â”€â”€â”                                       â”‚
â”‚                         â”œâ”€â”€â†’ resolveUserRole() â”€â”€â†’ 'org_admin'   â”‚
â”‚  'gestor'              â”€â”€â”˜                                       â”‚
â”‚                                                                   â”‚
â”‚  'advogado'                                                       â”‚
â”‚  'secretaria'          â”€â”€â†’ resolveUserRole() â”€â”€â†’ 'user'          â”‚
â”‚  'leitura'             â”€â”€â”˜                                       â”‚
â”‚                                                                   â”‚
â”‚  ESPECIAL: usuarios.permissoes = ['fartech_admin']              â”‚
â”‚         â”€â”€â†’ resolveUserRole() â”€â”€â†’ 'fartech_admin'                â”‚
â”‚                                                                   â”‚
â”‚  RESULTADO TypeScript:                                           â”‚
â”‚  â”œâ”€ 'fartech_admin' â†’ FARTECH_ADMIN_PERMISSIONS (11 recursos)   â”‚
â”‚  â”œâ”€ 'org_admin'     â†’ ORG_ADMIN_PERMISSIONS (25 aÃ§Ãµes)           â”‚
â”‚  â””â”€ 'user'          â†’ USER_PERMISSIONS (20 aÃ§Ãµes)                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  Fluxo de Resolvimento de PermissÃ£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMO O SISTEMA RESOLVE PERMISSÃ•ES (Internamente)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1. USER FASTS LOGIN                                             â”‚
â”‚     â””â”€ auth.getUser() â†’ { id, email, metadata }                 â”‚
â”‚                              â†“                                   â”‚
â”‚  2. BUSCA INFO USUÃRIO                                           â”‚
â”‚     â””â”€ SELECT * FROM usuarios WHERE id = user.id                â”‚
â”‚        â””â”€ usuarios.permissoes = []                              â”‚
â”‚           â””â”€ NÃƒO Ã© fartech_admin                                â”‚
â”‚                              â†“                                   â”‚
â”‚  3. BUSCA MEMBERSHIP                                             â”‚
â”‚     â””â”€ SELECT * FROM org_members WHERE user_id = user.id        â”‚
â”‚        â””â”€ org_members.role = 'gestor'                           â”‚
â”‚                              â†“                                   â”‚
â”‚  4. MAPEIA ROLE                                                  â”‚
â”‚     â””â”€ resolveUserRole(false, 'gestor')                         â”‚
â”‚        â””â”€ roleMap['gestor'] = 'org_admin'                       â”‚
â”‚                              â†“                                   â”‚
â”‚  5. OBTÃ‰M PERMISSÃ•ES                                             â”‚
â”‚     â””â”€ getPermissionsByRole('org_admin')                        â”‚
â”‚        â””â”€ Retorna ORG_ADMIN_PERMISSIONS (25 aÃ§Ãµes)              â”‚
â”‚                              â†“                                   â”‚
â”‚  6. ARMAZENA EM CACHE                                            â”‚
â”‚     â””â”€ cachedUser = { role: 'org_admin', ... }                  â”‚
â”‚        â”œâ”€ TTL: 10 segundos                                      â”‚
â”‚        â””â”€ PrÃ³ximas verificaÃ§Ãµes: <1ms                           â”‚
â”‚                              â†“                                   â”‚
â”‚  7. VERIFICA AÃ‡ÃƒO                                                â”‚
â”‚     â””â”€ checkPermission({ resource: 'tarefas', action: 'approve' })
â”‚        â””â”€ Procura em ORG_ADMIN_PERMISSIONS                      â”‚
â”‚           â””â”€ ENCONTRADO âœ… â†’ PERMITIDO                          â”‚
â”‚                                                                   â”‚
â”‚  RESULTADO: UsuÃ¡rio tem acesso completo como gestor âœ…           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ ComparaÃ§Ã£o: Antes vs Depois

```
ANTES (âŒ COM BUG)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ isCurrentUserAdminish()        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ role = 'org_admin'        â”‚  â”‚
â”‚ â”‚                           â”‚  â”‚
â”‚ â”‚ ['admin','gestor',        â”‚  â”‚
â”‚ â”‚  'org_admin'].includes    â”‚  â”‚
â”‚ â”‚  ('org_admin') âœ…         â”‚  â”‚
â”‚ â”‚                           â”‚  â”‚
â”‚ â”‚ Mas... nunca 'admin' ou   â”‚  â”‚
â”‚ â”‚ 'gestor' porque jÃ¡ foram  â”‚  â”‚
â”‚ â”‚ mapeados! âŒ              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ RESULTADO: false (gestores    â”‚
â”‚            sem acesso) âŒ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DEPOIS (âœ… CORRIGIDO)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ isCurrentUserAdminish()        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ role = 'org_admin'        â”‚  â”‚
â”‚ â”‚                           â”‚  â”‚
â”‚ â”‚ role === 'org_admin' âœ…   â”‚  â”‚
â”‚ â”‚ (compara com valor        â”‚  â”‚
â”‚ â”‚  mapeado corretamente)    â”‚  â”‚
â”‚ â”‚                           â”‚  â”‚
â”‚ â”‚ Simples e correto! âœ…     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ RESULTADO: true (gestores     â”‚
â”‚            com acesso) âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Matriz de Recursos Ã— AÃ§Ãµes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESOURCE            â”‚ USER PERM  â”‚ ORG ADMINâ”‚ FARTECH  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ organizations       â”‚ R          â”‚ R,U      â”‚ manage   â”‚
â”‚ users               â”‚ R          â”‚ C,R,U,D  â”‚ manage   â”‚
â”‚ leads               â”‚ C,R,U      â”‚ manage   â”‚ manage   â”‚
â”‚ clients             â”‚ C,R,U      â”‚ manage   â”‚ manage   â”‚
â”‚ cases               â”‚ C,R,U      â”‚ manage   â”‚ manage   â”‚
â”‚ documents           â”‚ C,R,U      â”‚ manage   â”‚ manage   â”‚
â”‚ agenda              â”‚ C,R,U,D    â”‚ manage   â”‚ manage   â”‚
â”‚ integrations        â”‚ R          â”‚ manage   â”‚ manage   â”‚
â”‚ settings            â”‚ âœ—          â”‚ manage   â”‚ manage   â”‚
â”‚ billing             â”‚ âœ—          â”‚ R        â”‚ manage   â”‚
â”‚ reports             â”‚ R          â”‚ R,C      â”‚ manage   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL AÃ‡Ã•ES         â”‚ 20         â”‚ 25       â”‚ 11       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legenda:
  C = CREATE    R = READ    U = UPDATE    D = DELETE
  manage = C,R,U,D    âœ— = Sem acesso
```

---

## âœ… Status Final

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPONENTE                        STATUS                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mapeamento de Roles               âœ… Correto            â”‚
â”‚ FunÃ§Ãµes de VerificaÃ§Ã£o            âœ… Implementado       â”‚
â”‚ Cache com TTL                     âœ… Funcional          â”‚
â”‚ RLS Policies                      âœ… 12 policies        â”‚
â”‚ Fluxo de Tarefas                  âœ… Completo           â”‚
â”‚ Acesso do Advogado                âœ… Validado           â”‚
â”‚ Acesso do Gestor                  âœ… RESTAURADO         â”‚
â”‚ Acesso do Admin Fartech           âœ… Total              â”‚
â”‚ DocumentaÃ§Ã£o                      âœ… 5 arquivos         â”‚
â”‚ SQL Consolidado                   âœ… Pronto             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADO FINAL: âœ… PRONTO PARA PRODUÃ‡ÃƒO
```

---

**VisualizaÃ§Ã£o Criada**: 28 de janeiro de 2026  
**Para ReferÃªncia RÃ¡pida e CompreensÃ£o Visual**

